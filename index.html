<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mindful Flow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&display=swap');

        :root {
            --bg-color: #ffffff;
            --main-text: #1a1a1a;
            --accent-soft: #f8f8f8;
        }

        body {
            font-family: 'Noto Sans JP', sans-serif;
            background-color: var(--bg-color);
            color: var(--main-text);
            overflow: hidden;
            touch-action: manipulation;
        }

        .fade-in {
            animation: fadeIn 2.5s ease-out forwards;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* 呼吸ガイドのアニメーション */
        @keyframes breathing {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.6); opacity: 0.25; }
        }

        .anim-breathing {
            animation: breathing 8s ease-in-out infinite;
        }

        /* 中央のタイマー円：内側から満たされる */
        #inner-fill {
            transition: transform 1s linear;
            transform: scale(0);
            transform-origin: center;
        }

        /* スライダーのカスタマイズ（少し操作しやすく） */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            height: 40px;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 2px;
            background: #eee;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #1a1a1a;
            margin-top: -9px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
    </style>
</head>
<body class="flex flex-col items-center justify-between min-h-screen p-10 pb-20">

    <!-- ヘッダー -->
    <header class="w-full text-center space-y-4 mt-4 fade-in">
        <h1 class="text-2xl font-light tracking-[0.4em] uppercase">Mindful Flow</h1>
        <p id="status-text" class="text-sm text-gray-400 font-light tracking-widest transition-opacity duration-1000">心を静める準備</p>
    </header>

    <!-- メイン：ビジュアルタイマー -->
    <div class="relative flex items-center justify-center w-full aspect-square max-w-sm">
        <!-- 呼吸ガイド（背景で動く円） -->
        <div id="breath-node" class="absolute w-48 h-48 bg-black rounded-full blur-3xl opacity-0 transition-opacity duration-1000"></div>
        
        <!-- 外側の枠線 -->
        <div class="absolute w-64 h-64 md:w-80 md:h-80 border border-gray-100 rounded-full"></div>

        <!-- 中央の満ちていく円 -->
        <div id="inner-fill" class="absolute w-64 h-64 md:w-80 md:h-80 bg-black rounded-full opacity-[0.03]"></div>
        
        <!-- センタードット -->
        <div class="w-2 h-2 bg-black rounded-full opacity-20"></div>
    </div>

    <!-- コントロール -->
    <div class="w-full max-w-xs flex flex-col items-center space-y-16">
        
        <!-- 時間設定 -->
        <div id="settings" class="w-full space-y-6 transition-all duration-1000">
            <input type="range" id="time-slider" min="0.5" max="15" step="0.5" value="3" class="w-full">
            <div class="flex justify-center">
                <span id="set-time-label" class="text-xs text-gray-500 tracking-[0.2em] font-medium uppercase">3 MINUTES</span>
            </div>
        </div>

        <!-- アクションボタン -->
        <div class="flex flex-col items-center space-y-8">
            <button id="start-btn" class="text-sm tracking-[0.5em] text-black border-b-2 border-transparent hover:border-black py-2 transition-all duration-700">
                START
            </button>
            <button id="reset-btn" class="text-[10px] tracking-[0.3em] text-gray-300 uppercase opacity-0 pointer-events-none transition-all duration-1000">
                Cancel Session
            </button>
        </div>
    </div>

    <!-- 完了オーバーレイ -->
    <div id="overlay" class="fixed inset-0 bg-white flex flex-col items-center justify-center opacity-0 pointer-events-none transition-opacity duration-[2000ms] z-50 p-12 text-center">
        <div class="w-2 h-2 bg-black rounded-full mb-10 animate-ping"></div>
        <p class="text-base font-light tracking-[0.2em] text-gray-600 leading-relaxed">
            一息つきました。<br>
            新しい気持ちで始めましょう。
        </p>
        <button id="close-overlay" class="mt-20 text-[11px] tracking-[0.4em] text-gray-400 border border-gray-200 px-10 py-3 rounded-full uppercase">Return</button>
    </div>

    <script>
        const innerFill = document.getElementById('inner-fill');
        const statusText = document.getElementById('status-text');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const timeSlider = document.getElementById('time-slider');
        const setTimeLabel = document.getElementById('set-time-label');
        const settingsDiv = document.getElementById('settings');
        const breathNode = document.getElementById('breath-node');
        const overlay = document.getElementById('overlay');
        const closeOverlay = document.getElementById('close-overlay');

        let timeLeft = 180;
        let totalTime = 180;
        let timerInterval = null;
        let isRunning = false;

        function updateDisplay() {
            // 時間の経過に合わせてスケールを0から1へ（満たしていく）
            const progress = (totalTime - timeLeft) / totalTime;
            innerFill.style.transform = `scale(${progress})`;
        }

        timeSlider.addEventListener('input', (e) => {
            const val = parseFloat(e.target.value);
            totalTime = val * 60;
            timeLeft = totalTime;
            if (val === 0.5) {
                setTimeLabel.textContent = `30 SECONDS`;
            } else {
                setTimeLabel.textContent = `${val} ${val == 1 ? 'MINUTE' : 'MINUTES'}`;
            }
            updateDisplay();
        });

        function toggleTimer() {
            if (isRunning) {
                // 一時停止
                clearInterval(timerInterval);
                startBtn.textContent = 'RESUME';
                statusText.textContent = '小休止';
                breathNode.classList.remove('anim-breathing');
                isRunning = false;
            } else {
                // 開始
                isRunning = true;
                startBtn.textContent = 'PAUSE';
                statusText.textContent = 'ゆっくりと呼吸を';
                
                resetBtn.classList.remove('opacity-0', 'pointer-events-none');
                settingsDiv.style.opacity = '0';
                settingsDiv.style.pointerEvents = 'none';
                
                // 呼吸ガイド起動
                breathNode.classList.add('opacity-100', 'anim-breathing');

                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateDisplay();
                    if (timeLeft <= 0) completeTimer();
                }, 1000);
            }
        }

        function completeTimer() {
            clearInterval(timerInterval);
            overlay.classList.remove('pointer-events-none');
            overlay.classList.add('opacity-100');
            resetTimer();
        }

        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            timeLeft = totalTime;
            startBtn.textContent = 'START';
            statusText.textContent = '心を静める準備';
            resetBtn.classList.add('opacity-0', 'pointer-events-none');
            settingsDiv.style.opacity = '1';
            settingsDiv.style.pointerEvents = 'auto';
            breathNode.classList.remove('opacity-100', 'anim-breathing');
            updateDisplay();
        }

        startBtn.addEventListener('click', toggleTimer);
        resetBtn.addEventListener('click', resetTimer);
        closeOverlay.addEventListener('click', () => {
            overlay.classList.add('opacity-0');
            overlay.classList.add('pointer-events-none');
        });

        updateDisplay();
    </script>
</body>
</html>
